<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://www.facebook.com/2008/fbml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <title>New Graph api & Javascript Base FBConnect Tutorial | precidix.com</title>
    </head>
    <body>
		 <div id="fb-root"></div>
		 <script src="http://connect.facebook.net/en_US/all.js"></script>
        <script type="text/javascript">
            window.fbAsyncInit = function() {
                FB.init({appId: '154400931252071', status: true, cookie: true, xfbml: true});

                /* All the events registered */
                FB.Event.subscribe('auth.login', function(response) {
                    // do something with response
                    login();
                });
                FB.Event.subscribe('auth.logout', function(response) {
                    // do something with response
                    logout();
                });

                FB.getLoginStatus(function(response) {
                    if (response.session) {
                        // logged in and connected user, someone you know
                        login();
                    }
                });
            };
            (function() {
                var e = document.createElement('script');
                e.type = 'text/javascript';
                e.src = document.location.protocol +
                    '//connect.facebook.net/en_US/all.js';
                e.async = true;
                document.getElementById('fb-root').appendChild(e);
            }());

            function login(){
                FB.api('/me', function(response) {
                    document.getElementById('login').style.display = "block";
                    document.getElementById('login').innerHTML = response.name + " succsessfully logged in!";
                });
            }
            function logout(){
                document.getElementById('login').style.display = "none";
            }

            //stream publish method
            function streamPublish(name, description, hrefTitle, hrefLink, userPrompt){
                FB.ui(
                {
                    method: 'stream.publish',
                    message: '',
                    attachment: {
                        name: name,
                        caption: '',
                        description: (description),
                        href: hrefLink
                    },
                    action_links: [
                        { text: hrefTitle, href: hrefLink }
                    ],
                    user_prompt_message: userPrompt
                },
                function(response) {

                });

            }
            function showStream(){
                FB.api('/me', function(response) {
                    //console.log(response.id);
                    streamPublish(response.name, 'ESMZone the place for Student Athletes', 'hrefTitle', 'http://dev.precidix.com', "Share esmzone.com");
                });
            }

            function share(){
                var share = {
                    method: 'stream.share',
                    u: 'http://dev.precidix.com/'
                };

                FB.ui(share, function(response) { console.log(response); });
            }

            function graphStreamPublish(){
                var body = 'Reading New Graph api & Javascript Base FBConnect Tutorial from Precidix.com';
                FB.api('/me/feed', 'post', { message: body }, function(response) {
                    if (!response || response.error) {
                        alert('Error occured');
                    } else {
                        alert('Post ID: ' + response.id);
                    }
                });
            }

            function fqlQuery(){
                FB.api('/me', function(response) {
                     var query = FB.Data.query('select name, hometown_location, sex, pic_square from user where uid={0}', response.id);
                     query.wait(function(rows) {
                       
                       document.getElementById('name').innerHTML =
                         'Your name: ' + rows[0].name + "<br />" +
                         '<img src="' + rows[0].pic_square + '" alt="" />' + "<br />";
                     });
                });
            }

            function setStatus(){
                status1 = document.getElementById('status').value;
                FB.api(
                  {
                    method: 'status.set',
                    status: status1
                  },
                  function(response) {
                    if (response == 0){
                        alert('Your facebook status not updated. Give Status Update Permission.');
                    }
                    else{
                        alert('Your facebook status updated');
                    }
                  }
                );
            }
           
            function fb_inviteFriends() {
                //Invite users
                //log("Inviting users...");
                //var uid = FB.Facebook.apiClient.get_session().uid;
                //log('FB CONNECT SUCCESS: ' + uid);
                //Invite users
                //log("Inviting users...");
                //Update server with connected account
                //updateAccountFacebookUID();
                  var dialog = {
				    method: 'fbml.dialog',
				    display: 'dialog',
				    fbml: '<fb:header icon="false" decoration="add_border">Hello World!</fb:header><fb:profile-pic uid="5526183"></fb:profile-pic>',
				    width: 800,
				    height: 100
				  };
                //var fbml = fb_getInviteFBML() ;
                FB.ui(dialog, Log.info.bind('fbml.dialog callback'));
			} 
			/*			
			function fb_getInviteFBML() {
			    var fbml = "";
			    fbml = 
			    '<fb:fbml>\n' +
			        '<fb:request-form\n'+
			                            //Redirect back to this page
			                            ' action="'+ document.location +'"\n'+
			                            ' method="POST"\n'+
			                            ' invite="true"\n'+
			                            ' type="Weblings Invite"\n' +
			                            ' content="I need your help to discover all the Weblings and save the Internet! WebWars: Weblings is a cool new game where we can collect fantastic creatures while surfing our favorite websites. Come find the missing Weblings with me!'+ 
			                            //Callback the server with the appropriate Webwars Account URL
			                            ' <fb:req-choice url=\'dev.precidix.com:8090/esmzone?action=ref&reftype=Facebook\' label=\'Check out WebWars: Weblings\' />"\n'+
			                      '>\n'+
			                       ' <fb:multi-friend-selector\n'+
			                            ' rows="2"\n'+
			                            ' cols="4"\n'+
			                            ' bypass="Cancel"\n'+
			                            ' showborder="false"\n'+
			                            ' actiontext="Use this form to invite your friends to connect with WebWars: Weblings."/>\n'+
			                ' </fb:request-form>'+
			        ' </fb:fbml>';
			    return fbml;
			}
            */
        </script>

        <h3>New Graph api & Javascript Base FBConnect Tutorial | Precidix.com</h3>
        <p><fb:login-button autologoutlink="true" perms="email,user_birthday,status_update,publish_stream"></fb:login-button></p>

        <p>
            <a href="#" onclick="showStream(); return false;">Publish Wall Post</a> |
            <a href="#" onclick="share(); return false;">Share With Your Friends</a> |
            <a href="#" onclick="graphStreamPublish(); return false;">Publish Stream Using Graph API</a> |
            <a href="#" onclick="fb_inviteFriends(); return false;">Invite Friends</a> 
            <a href="#" onclick="fqlQuery(); return false;">FQL Query Example</a> 
        </p>

        <textarea id="status" cols="50" rows="5">Write your status here and click 'Status Set Using Legacy Api Call'</textarea>
        <br />
        <a href="#" onclick="setStatus(); return false;">Status Set Using Legacy Api Call</a>

        <br /><br /><br />
        <div id="login" style ="display:none"></div>
        <div id="name"></div>
        
        <div style="margin-left:-5px;">
			<fb:serverfbml width="615">
			<script type="text/fbml">
    				<fb:request-form action="http://dev.precidix.com:8090/esmzone"
                    	method="POST"
                     	invite="true"
                     	type="Esmzone"
                     	content="Join ESMZone! <fb:req-choice url='http://dev.precidix.com:8090/esmzone/register?coupon=esmzone' label='Join Esmzone!' />">
      					<fb:multi-friend-selector showborder="false"
                                bypass="cancel"
                                cols=4
                                actiontext="Please join ESMZONE Now!"/>
    				</fb:request-form>
  			</script>
			</fb:serverfbml>		
		</div>

    </body>
</html>